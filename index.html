<!DOCTYPE html>
<html lang="sq">
<head>
<meta charset="UTF-8">
<title>POS Market ‚Äì FINAL HTTPS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Segoe UI;background:#eef2f7}
header{background:#1e293b;color:#fff;padding:12px}
nav button{margin:4px;padding:10px;border:none;border-radius:10px;background:#334155;color:#fff}
section{display:none;padding:15px}
section.active{display:block}
.card{background:#fff;padding:15px;border-radius:14px;margin-bottom:12px;box-shadow:0 8px 18px rgba(0,0,0,.1)}
input,button{padding:8px;border-radius:8px;border:1px solid #cbd5f5}
button{background:#2563eb;color:#fff;font-weight:600;margin:3px}
button.alt{background:#0f766e}
button.warn{background:#b91c1c}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:6px;border-bottom:1px solid #e5e7eb;text-align:center}
th{background:#f1f5f9}
.admin{display:none}
#scanner{width:100%;height:260px;background:#000;border-radius:12px}
</style>

<script src="https://unpkg.com/@ericblade/quagga2/dist/quagga.js"></script>
</head>

<body>

<header>
<h2>üõí POS Market</h2>
<nav id="menu" style="display:none">
<button onclick="openSec('stock')" class="admin">Stok</button>
<button onclick="openSec('sale')">Shitje</button>
<button onclick="openSec('bil')" class="admin">Bilanc</button>
<button onclick="logout()">Dil</button>
</nav>
</header>

<!-- LOGIN -->
<section id="loginSec" class="active">
<div class="card">
<h3>Login</h3>
<input id="u" placeholder="admin">
<input id="p" type="password" placeholder="admin">
<button onclick="doLogin()">Login</button>
<p id="msg" style="color:red"></p>
</div>
</section>

<!-- STOK -->
<section id="stock">
<div class="card admin">
<h3>Shto Produkt</h3>
<input id="sn" placeholder="Emri">
<input id="sb" placeholder="Barkod">
<input id="sp" type="number" placeholder="√ámimi">
<input id="ss" type="number" placeholder="Sasia">
<br>
<button onclick="addProd()">‚ûï Shto</button>
<button class="alt" onclick="startScan('stock')">üì∑ Scan Barkod</button>
</div>

<div class="card">
<div id="scanner"></div>
<button class="warn" onclick="stopScan()">‚ùå Mbyll Kamer√´n</button>
</div>

<div class="card">
<table id="stockTable"></table>
</div>
</section>

<!-- SHITJE -->
<section id="sale">
<div class="card">
<input id="scan" placeholder="Scan barkod / USB">
<button class="alt" onclick="startScan('sale')">üì∑ Kamera</button>
<button onclick="addSale()">Shto</button>
</div>

<div class="card">
<table id="saleTable"></table>
<h3>Total: <span id="total">0</span> ALL</h3>
<input id="paid" type="number" placeholder="Paguar">
<h3>Kusur: <span id="change">0</span></h3>
<button onclick="pay()">Paguaj</button>
</div>
</section>

<!-- BILANC -->
<section id="bil" class="admin">
<div class="card">
<h3>üìä Bilanc</h3>
<p>Shitje: <b><span id="daily">0</span> ALL</b></p>
<input id="cashReal" type="number" placeholder="Para reale">
<p>Diferenca: <b><span id="diff">0</span></b></p>
<button onclick="closeDay()">Mbyll Dit√´n</button>
</div>
</section>

<script>
const USERS=[{u:'admin',p:'admin',r:'admin'},{u:'kasier',p:'kasier',r:'kasier'}];
let role=null;
let products=JSON.parse(localStorage.getItem('products')||'[]');
let sales=[];
let daily=+localStorage.getItem('daily')||0;
let scanTarget='sale';

/* LOGIN */
function doLogin(){
 const f=USERS.find(x=>x.u===u.value&&x.p===p.value);
 if(!f){msg.textContent='Login gabim';return}
 role=f.r;loginSec.style.display='none';menu.style.display='block';
 document.querySelectorAll('.admin').forEach(e=>e.style.display=role==='admin'?'block':'none');
 openSec('sale');renderStock();updateDaily();
}
function logout(){location.reload()}
function openSec(id){document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active')}

/* STOK */
function addProd(){products.push({n:sn.value,b:sb.value,p:+sp.value,s:+ss.value});save()}
function renderStock(){
 stockTable.innerHTML='<tr><th>Em√´r</th><th>Barkod</th><th>√ámim</th><th>Sasi</th></tr>';
 products.forEach(p=>stockTable.innerHTML+=`<tr><td>${p.n}</td><td>${p.b}</td><td>${p.p}</td><td>${p.s}</td></tr>`);
}

/* SHITJE */
function addSale(){
 const v=scan.value.trim();
 const p=products.find(x=>x.b===v);
 if(!p||p.s<1)return alert('Ska stok');
 sales.push({n:p.n,b:p.b,p:p.p,q:1});drawSale();scan.value='';
}
function drawSale(){
 saleTable.innerHTML='<tr><th>Produkt</th><th>Sasi</th><th>Total</th></tr>';
 let t=0;
 sales.forEach(x=>{t+=x.p*x.q;saleTable.innerHTML+=`<tr><td>${x.n}</td><td>${x.q}</td><td>${x.p*x.q}</td></tr>`});
 total.textContent=t;change.textContent=(+paid.value||0)-t;
}

/* CAMERA */
function startScan(target){
 scanTarget=target;
 Quagga.init({
  inputStream:{name:"Live",type:"LiveStream",target:document.querySelector('#scanner'),
  constraints:{facingMode:"environment"}},
  decoder:{readers:["ean_reader","code_128_reader","ean_8_reader"]}
 },err=>{
  if(err){alert('Kamera nuk u hap');return}
  Quagga.start();
 });
 Quagga.onDetected(d=>{
  const code=d.codeResult.code;
  if(scanTarget==='stock')sb.value=code;
  else{scan.value=code;addSale();}
  stopScan();
 });
}
function stopScan(){Quagga.stop();document.getElementById('scanner').innerHTML=''}

/* BILANC */
function updateDaily(){dailyEl.textContent=daily}
cashReal.oninput=()=>{const d=(+cashReal.value||0)-daily;diff.textContent=d;diff.style.color=d<0?'red':'green'}
function closeDay(){daily=0;localStorage.setItem('daily',0);updateDaily()}
</script>

</body>
</html>
